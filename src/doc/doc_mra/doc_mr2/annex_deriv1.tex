\chapter*{Appendix C: Derivative Needed for the Minimization}
\label{annexB}
\addcontentsline{toc}{chapter}{Appendix C: Derivative Needed for the 
Minimization}

\subsection*{The error function}
 The error function is written erf(x) and the complementary error function
 erfc(x). Their definitions are:
\begin{eqnarray}
  \mbox{erf(x)} = \frac{2}{\sqrt{\pi}}\int_{0}^{x} e^{-t^{2}} dt 
\end{eqnarray}

\begin{eqnarray}
  \mbox{erfc}(x) = 1-\mbox{erf}(x) = \frac{2}{\sqrt{\pi}}\int_{x}^{\infty} e^{-t^{2}} dt 
\end{eqnarray}

These functions have the following limits and symmetries:
\begin{eqnarray}
   \begin{tabular}{c|c} 
   \hline
    \mbox{erf}(0) = 0         & $ \mbox{erf}(\infty) = 1 $  \\
   \mbox{erfc}(0) = 1        & $  \mbox{erfc}(\infty) = 0 $ \\
   \mbox{erf}(-x) = \mbox{erf}(x)   &   \mbox{erfc}(-x) = 2-\mbox{erfc}(x) \\
   \hline
   \end{tabular}
\end{eqnarray}

\subsection*{N1-MSE}
Now we compute the contribution of the wavelet coefficient $x$ to the noise information: 
\begin{eqnarray}
h_{n}(x) = \frac{x^2}{2\sigma^2}\mbox{erfc}(\frac{x}{\sqrt{2}\sigma})
\end{eqnarray}

\begin{eqnarray}
\frac{ d h_{n}(x)}{dx} = \frac{x}{\sigma^2}\mbox{erfc}(\frac{x}{\sqrt{2}\sigma}) + \frac{x^2}{2\sigma^2} \frac{\partial \mbox{erfc}(\frac{x}{\sqrt{2}\sigma})}{\partial x} 
\end{eqnarray}
We derive the function erfc:
\begin{eqnarray}
\frac{\partial \: \mbox{erfc}(x)}{\partial x} = - \frac{2}{\sqrt{\pi}}   e^{-x^{2}} 
\end{eqnarray}
then 
\begin{eqnarray}
\frac{ d h_{n}(x)}{dx} = \frac{x}{\sigma^2}\mbox{erfc}(\frac{x}{\sqrt{2}\sigma})  -\frac{x^2}{\sqrt{2\pi}\sigma^3}e^{-\frac{x^{2}}{2\sigma^2}} 
\end{eqnarray}

In order to minimize the functional~\ref{eqn_func1}, we may want to calculate
the derivative of $h_s(x-y)$, $h_s(x-y)$ measuring the amount of information
contained in the residual ($y$ being the data).
\begin{eqnarray}
h_s(x-y) = \frac{(y-x)^2}{2\sigma^2}\mbox{erf}(\frac{y-x}{\sqrt{2}\sigma}) 
\end{eqnarray}
Denoting $z = y - x$, we have
\begin{eqnarray}
h_s(z) = \frac{z^2}{2\sigma^2}\mbox{erf}(\frac{z}{\sqrt{2}\sigma}) 
\end{eqnarray}
\begin{eqnarray}
\frac{ d h_{s}(z)}{dz} & = & \frac{z}{\sigma^2}\mbox{erf}(\frac{z}{\sqrt{2}\sigma}) + \frac{z^2}{2\sigma^2} \frac{\partial \mbox{erf}(\frac{z}{\sqrt{2}\sigma})}{\partial z}  \\
                & = & \frac{z}{\sigma^2}\mbox{erf}(\frac{z}{\sqrt{2}\sigma}) + \frac{z^2}{\sqrt{2\pi}\sigma^3} e^{-\frac{z^{2}}{2\sigma^2}}
\end{eqnarray}
and
\begin{eqnarray}
\frac{ d h_{s}(x-y)}{dx}  =  - \frac{ d h_{s}(z)}{dz}
\end{eqnarray}


\subsection*{N2-MSE}
We compute the contribution of the wavelet coefficient $x$ to the noise information: 
\begin{eqnarray}
h_{n}(x) = 
\frac{1}{\sigma^{2}}\int_{0}^{x} t \: \mbox{erfc}( \frac{x-t}{\sqrt{2}\sigma}) dt 
\end{eqnarray}

\begin{eqnarray}
\frac{d h_{n}(x)}{dx} &  = &  h_{n}(x+dx) - h_{n}(x)  \\
   &  = & \frac{1}{\sigma^{2}} \int_{0}^{x+dx} 
             \mbox{erfc}(\frac{x+dx-t}{\sqrt{2}\sigma}) dt -
\frac{1}{\sigma^{2}}\int_{0}^{x} \mbox{erfc} (\frac{x-t}{\sqrt{2}\sigma}) dt 
\end{eqnarray}

\begin{eqnarray}
\frac{d h_{n}(x)}{dx} = 
\frac{x}{\sigma^{2}}  \, \mbox{erfc}( \frac{x-x}{\sqrt{2}\sigma})  +
\frac{1}{\sigma^{2}}\int_{0}^{x} 
          \frac{ \partial \: t \, \mbox{erfc} (\frac{x-t}{\sqrt{2}\sigma})}{ \partial x} dt 
\end{eqnarray}

Now, because erfc(0) = 1  we have:
\begin{eqnarray}
\frac{d H_{n}(x)}{dx} = 
\frac{x}{\sigma^{2}}   +
\frac{1}{\sigma^{2}}\int_{0}^{x} 
          \frac{ \partial \: t \, \mbox{erfc} (\frac{x-t}{\sqrt{2}\sigma})}{ \partial x} dt 
\end{eqnarray}

We derive the function erfc:
\begin{eqnarray}
\frac{\partial \: \mbox{erfc}(x)}{\partial x} = - \frac{2}{\sqrt{\pi}}   e^{-x^{2}} 
\end{eqnarray}

\begin{eqnarray}
\frac{ \partial\:  \mbox{erfc}( \frac{(x-t)}{\sqrt{2}\sigma} )}{\partial x} = 
-\frac{2}{\sqrt{\pi}} \frac{1}{\sqrt{2}\sigma}  
  e^{-\frac{(x-t)^{2}}{2\sigma^{2}}} =
 -\sqrt{\frac{2}{\pi}} \frac{1}{\sigma} e^{-\frac{(x-t)^{2}}{2\sigma^{2}}}
\end{eqnarray}

Now we deduce for the derivative of $h_n$:

\begin{eqnarray}
\frac{d h_{n}(x)}{dx} = 
\frac{x}{\sigma^{2}}   +
\frac{1}{\sigma^{2}}\int_{0}^{x} 
 -\sqrt{\frac{2}{\pi}}\frac{1}{\sigma}t \, e^{-\frac{(x-t)^{2}}{2\sigma^{2}}}dt 
\end{eqnarray}

\begin{eqnarray}
\frac{d h_{n}(x)}{dx} = 
\frac{x}{\sigma^{2}}   +
\frac{1}{\sigma^{3}}\sqrt{\frac{2}{\pi}} \int_{0}^{x} t \, e^{-\frac{(x-t)^{2}}{2\sigma^{2}}}dt 
\end{eqnarray}

We create the variable J
\begin{eqnarray}
J = \int_{0}^{x} t \, e^{-\frac{(x-t)^{2}}{2\sigma^{2}}}dt 
\end{eqnarray}

We create the variable u
\begin{eqnarray}
\begin{array}{cc} 
  u = \frac{t-x}{\sqrt{2}\sigma}  &  t = x+u \, \sqrt{2}\sigma         \\
   & dt = \sqrt{2}\sigma du         \\
  t=0 \Rightarrow u = \frac{-x}{\sqrt{2}\sigma}  &
  t=x \Rightarrow u = 0                     \\
   \end{array}
\end{eqnarray}


The variable J can be written with u
\begin{eqnarray}
 J = \int_{\frac{-x}{\sqrt{2}\sigma} }^{0} (x+u \,\sqrt{2}\sigma) e^{-u^{2}}\sqrt{2}\sigma du
\end{eqnarray}
\begin{eqnarray}
 J = \sqrt{2}\sigma x \int_{\frac{-x}{\sqrt{2}\sigma} }^{0} 
 e^{-u^{2}} du  +
 2 \sigma^{2} \int_{\frac{-x}{\sqrt{2}\sigma} }^{0} u \,
 e^{-u^{2}} du
\end{eqnarray}

The first part of J can be rewritten as:
\begin{eqnarray}
 J_{0} = \sqrt{2}\sigma x \int_{0}^{\frac{x}{\sqrt{2}\sigma} } 
 e^{-u^{2}} du  
\end{eqnarray}
$ J_{0} $ can be expressed with the error function.
\begin{eqnarray}
 J_{0} = \sqrt{2}\sigma \frac{\sqrt{\pi}}{2} x  \mbox{erf}(\frac{x}{\sqrt{2}\sigma}) 
 J_{0} = \sigma \sqrt{\frac{\pi}{2}} \: x \:  \mbox{erf}(\frac{x}{\sqrt{2}\sigma}) 
\end{eqnarray}
Now the second part of J is obvious
\begin{eqnarray}
 J_{1} = 2 \sigma^{2} \int_{\frac{-x}{\sqrt{2}\sigma} }^{0} u \,
 e^{-u^{2}} du  
\end{eqnarray}
 or
\begin{eqnarray}
\frac{d e^{-u^{2}}} {du} = -2 u e^{-u^{2}} 
\end{eqnarray}

We replace
\begin{eqnarray}
 J_{1} = -\sigma^{2}  \int_{\frac{-x}{\sqrt{2}\sigma} }^{0} d(e^{-u^{2}})  
\end{eqnarray}
\begin{eqnarray}
 J_{1} = \sigma^{2}  [e^{-\frac{x^{2}}{2\sigma^{2}}} - 1]  
\end{eqnarray}

Now we can write J
\begin{eqnarray}
 J = J_{0} + J_{1}
  = \sigma \sqrt{\frac{\pi}{2}} \: x \:  \mbox{erf}(\frac{x}{\sqrt{2}\sigma}) 
    + \sigma^{2}  [e^{-\frac{x^{2}}{2\sigma^{2}}} - 1 ]  
\end{eqnarray}

Now we can write the derivative of $h_n$
\begin{eqnarray}
\frac{d h_{n}(x)}{dx} & = & 
\frac{x}{\sigma^{2}}   -
\frac{1}{\sigma^{3}} \sqrt{\frac{2}{\pi} } \: J \\
                   & = &   \frac{x}{\sigma^{2}} -
  \frac{x}{\sigma^{2}}\: x \:  \mbox{erf}(\frac{x}{\sqrt{2}\sigma})
  + \frac{1}{\sigma} \sqrt{\frac{2}{\pi} } \:
      [1 - e^{-\frac{x{2}}{2\sigma{2}}}]  \\
                    & = &  \frac{x}{\sigma^{2}}\mbox{erfc}(\frac{x}{\sqrt{2}\sigma})
    + \frac{1}{\sigma} \sqrt{\frac{2}{\pi} } \:
      [1 - e^{-\frac{x^{2}}{2\sigma^{2}}}] 
\end{eqnarray}

In order to minimize the functional~\ref{eqn_func1}, we may want to calculate
the derivative of $h_s(x \mid y)$, $h_s(x \mid 
y)$ measuring the amount of information
contained in the residual ($y$ being the data).
\begin{eqnarray}
h_s(x \mid y) = \frac{1}{\sigma^{2}} \int_{0}^{y-x} t \mbox{ erf}(\frac{y-x-t}{\sqrt{2}\sigma}) dt
\end{eqnarray}
Denoting $z = y - x$, we have
\begin{eqnarray}
h_s(z) &  =  & \frac{1}{\sigma^{2}} \int_{0}^{z} t \mbox{ erf}(\frac{z-t}{\sqrt{2}\sigma}) dt \\
       &  =  & \frac{1}{\sigma^{2}} \int_{0}^{z} t dt - \frac{1}{\sigma^{2}} \int_{0}^{z} t \mbox{ erfc}(\frac{z-t}{\sqrt{2}\sigma}) dt
\end{eqnarray} 
and
\begin{eqnarray}
\frac{d h_s(x)}{dx} = \frac{\partial h_s(z)}{\partial z} \frac{\partial z}{\partial x}
\end{eqnarray}
\begin{eqnarray}
\frac{\partial h_s(z)}{\partial z} & = \frac{z}{\sigma^2} - \frac{\partial h_n(z)}{\partial z}
 \end{eqnarray}
then
\begin{eqnarray}
\frac{d h_s(x)}{dx} & = & - \frac{y-x}{\sigma^2} + \frac{y-x}{\sigma^2}\mbox{erfc}(\frac{y-x}{\sqrt{2}\sigma}) + \sqrt{\frac{2}{\pi}}\frac{1}{\sigma}[1 - e^{-\frac{(y-x)^{2}}{2\sigma^{2}}}] \\
                    & = & - \frac{y-x}{\sigma^2} \mbox{erf}(\frac{y-x}{\sqrt{2}\sigma}) + \sqrt{\frac{2}{\pi}}\frac{1}{\sigma}[1 - e^{-\frac{(y-x)^{2}}{2\sigma^{2}}}]
\end{eqnarray}
